# 機能仕様書: 九九手裏剣（Kuku Shuriken）MVP

**機能ブランチ**: `feat/001-kuku-shuriken-mvp`
**作成日**: 2025-12-27
**ステータス**: ドラフト
**入力**: 九九手裏剣MVP - カードフリック式九九学習ゲーム

## ユーザーシナリオ & テスト *(必須)*

### ユーザーストーリー1 - 九九問題にフリックで回答する (優先度: P1)

小学生（6-12歳）が画面中央に表示された九九の問題カード（例: 「7×8」）を見て、正解の数字が書かれた「的（マト）」の方向へカードをフリックして回答する。正解すると手裏剣が的に刺さる心地よいアニメーションと効果音が再生され、次の問題が出題される。

**この優先度の理由**: これがゲームのコアメカニクスであり、このストーリーだけで最小限の価値を提供できる。フリック操作による直感的な回答体験が本プロダクトの差別化要因。

**独立テスト**: 1つの九九問題を表示し、4方向に的を配置した状態でフリック操作をテスト可能。正解方向へのフリックで的に当たり、不正解方向へのフリックで外れる動作を確認できる。

**受け入れシナリオ**:

1. **前提** アプリを起動し問題画面が表示されている, **操作** 画面中央のカードを正解の的の方向へフリックする, **結果** カードが手裏剣のように飛び、正解の的に刺さるアニメーションが再生され、次の問題が表示される
2. **前提** 問題カードが表示されている, **操作** 不正解の的の方向へカードをフリックする, **結果** 手裏剣が的を外れるアニメーションが再生され、同じ問題が再度表示される
3. **前提** 問題カードが表示されている, **操作** カードを正解方向へフリックする, **結果** 小気味よい効果音が再生される

---

### ユーザーストーリー2 - 難易度を選択してゲームを開始する (優先度: P1)

ユーザーがゲーム開始前に難易度（かんたん：2方向、ふつう：3方向、むずかしい：4方向）を選択し、選んだ難易度に応じた的の配置でゲームを開始する。

**この優先度の理由**: 対象年齢が6-12歳と幅広いため、低学年でも遊べる2方向モードと、上級者向けの4方向モードの両方が必要。難易度選択がないと特定の年齢層しか楽しめない。

**独立テスト**: 難易度選択画面を表示し、各難易度を選択してゲーム開始後の的の配置数を確認できる。

**受け入れシナリオ**:

1. **前提** アプリを起動した, **操作** 「かんたん」を選択してゲームを開始する, **結果** 的が2方向（上下または左右）に配置された状態でゲームが始まる
2. **前提** アプリを起動した, **操作** 「ふつう」を選択してゲームを開始する, **結果** 的が3方向に配置された状態でゲームが始まる
3. **前提** アプリを起動した, **操作** 「むずかしい」を選択してゲームを開始する, **結果** 的が4方向（上下左右）に配置された状態でゲームが始まる

---

### ユーザーストーリー3 - ゲーム中のスコアを確認する (優先度: P2)

ユーザーがゲームプレイ中に現在の連続正解数を確認でき、ゲーム終了時にセッションの結果（正答数、正答率、最大連続正解数）を確認できる。

**この優先度の理由**: スコア表示はモチベーション維持に重要だが、コアゲームプレイには必須ではない。P1機能が動作すれば最低限のゲーム体験は成立する。

**独立テスト**: ゲームを数問プレイし、画面上のスコア表示と終了時のリザルト表示を確認できる。

**受け入れシナリオ**:

1. **前提** ゲームをプレイ中, **操作** 画面を確認する, **結果** 現在の連続正解数が画面に表示されている
2. **前提** 10問回答した, **操作** ゲームが終了する, **結果** リザルト画面に正答数、正答率、最大連続正解数が表示される

---

### エッジケース

- 斜め方向（45度付近）へのフリック時は、最も近い的の方向として判定する
- 非常に短いフリック（移動距離が閾値未満）は無効とし、カードは元の位置に戻る
- 素早い連続フリックは、アニメーション完了まで次の入力を受け付けない
- 画面端を超えるフリックも正常に方向を検出する

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは九九の問題（2×2から9×9まで）をカード形式で画面中央に表示しなければならない
- **FR-002**: システムは問題カードを2〜4方向にフリック操作できるようにしなければならない
- **FR-003**: システムは正解1つと不正解（難易度に応じて1〜3つ）の的を画面端に配置しなければならない
- **FR-004**: システムはフリック方向を検出し、最も近い的の方向を判定しなければならない
- **FR-005**: システムは正解時に手裏剣が的に刺さるアニメーションを再生しなければならない
- **FR-006**: システムは不正解時に手裏剣が外れるアニメーションを再生しなければならない
- **FR-007**: システムは正解・不正解に応じた効果音を再生しなければならない
- **FR-008**: システムは難易度選択画面を提供し、2/3/4方向を選択できるようにしなければならない
- **FR-009**: システムはゲーム中に連続正解数をリアルタイム表示しなければならない
- **FR-010**: システムは10問回答後にリザルト画面を表示しなければならない

### 主要エンティティ

- **問題カード**: 九九の式（例: 7×8）を表示するUI要素。ユーザーがフリック操作する対象
- **的（マト）**: 回答の選択肢を表す標的。正解1つと不正解複数で構成
- **セッション**: 1回のゲームプレイ単位。10問で構成され、スコアを記録

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーは1問あたり平均5秒以内に回答できる
- **SC-002**: アニメーションは60fpsで滑らかに再生される
- **SC-003**: 初回利用者の90%が3問以内にフリック操作を理解できる
- **SC-004**: 1セッション（10問）を2分以内に完了できる
- **SC-005**: フリック方向の誤検出率が5%未満である
